<!doctype html>
<html>

<head>
    <title>Socket.IO chat</title>
    <link href="./content/css/chat.css" rel="stylesheet" />
</head>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>
    $(function () {
        var itsUser = prompt('your name?');
        var socket = io.connect("http://localhost:3000");
        $('form').submit(function () {
            socket.emit('chat message', $('#m').val());
            $('#m').val('');
            return false;
        });
        $('#m').on('keyup', function (isTyping) {
            if ($('#m').val())
                isTyping = true;
            else
                isTyping = false;

            socket.emit('user typing', isTyping);
            return false;
        })
        socket.on('connect', function (msg) {
            socket.emit('join', itsUser);
        });
        socket.on('join', function (user) {
            if (itsUser != user)
                $('#messages').append($('<li>' + user + " has joined the room!" + "</li>"));
            else
                $('#messages').append($('<li>' + "Welcome, " + user + "! Enjoy your visit!" + "</li>"));

        });
        socket.on('chat message', function (data) {
            if (itsUser != data.name)
                $('#messages').append($('<li>' + data.name + ": " + data.msg + "</li>"))
            else
                $('#messages').append($('<li>' + "You" + ": " + data.msg + "</li>"))
        });
        socket.on('leave', function (data) {
            $('#messages').append($('<li>' + data.name + " has left the room!" + "</li>"));
        });
        socket.on('user typing', function (data) {
            if (data.typing && data.name != itsUser)
                $('#user-typing').html(data.name + ' is typing...');
            else {
                $('#user-typing').html(" ");
            }
        });
    });
</script>


<body>
    <ul id="messages"></ul>
    <form action="">
        <input id="m" autocomplete="off" /><button>Send</button><button id="change-name">Change Name</button>
    </form>
    <div id="user-typing"></div>
</body>

</html>